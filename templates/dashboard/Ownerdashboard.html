<!doctype html>
{% csrf_token %}
{%load dashboardtags%}

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Restaurant Owner Dashboard</title>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
  </script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
  </script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet"
    id="bootstrap-css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Play" rel="stylesheet">
  <link rel="shortcut icon" type="image/favicon" href="img/favicon.ico">
</head>

<style>
  body {
    font-family: Tahoma, Geneva, sans-serif;
    background: url(img/pic1.jpg)no-repeat;
    background-size: cover;
  }

  *,
  *:before,
  *:after {
    box-sizing: border-box;
  }

  .lighter-text {
    color: #ABB0BE;
  }

  .main-color-text {
    color: $main-color;
  }

  .navbar-left {
    float: left;
  }

  .navbar-right {
    float: right;
  }

  .topnav {
    overflow: hidden;
    background-color: rgba(44, 62, 80, 0.7);
  }

  .topnav a {
    float: left;
    display: block;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
    font-size: 17px;
  }

  .topnav a:hover {
    background-color: black;
    color: white;
  }

  .topnav a.active {
    background-color: black;
    color: white;
  }

  .topnav input[type=text] {
    float: right;
    padding: 6px;
    border: none;
    margin-top: 8px;
    margin-right: 16px;
    font-size: 17px;
  }

  @media screen and (max-width: 600px) {

    .topnav a,
    .topnav input[type=text] {
      float: none;
      display: block;
      text-align: left;
      width: 100%;
      margin: 0;
      padding: 14px;
    }

    .topnav input[type=text] {
      border: 1px solid #ccc;
    }
  }


  .container {
    margin: auto;
    width: 80%;
  }

  .badge {
    background-color: #6394F8;
    border-radius: 10px;
    color: white;
    display: inline-block;
    font-size: 12px;
    line-height: 1;
    padding: 3px 7px;
    text-align: center;
    vertical-align: middle;
    white-space: nowrap;
  }

  .shopping-cart {
    margin: 20px 0;
    float: right;
    background: white;
    width: 320px;
    position: relative;
    border-radius: 3px;
    padding: 20px;


    .shopping-cart-header {
      border-bottom: 1px solid #E8E8E8;
      padding-bottom: 15px;

      .shopping-cart-total {
        float: right;
      }
    }

    .shopping-cart-items {

      padding-top: 20px;

      li {
        margin-bottom: 18px;
      }

      img {
        float: left;
        margin-right: 12px;
      }

      .item-name {
        display: block;
        padding-top: 10px;
        font-size: 16px;
      }

      .item-price {
        color: $main-color;
        margin-right: 8px;
      }

      .item-quantity {
        color: $light-text;
      }
    }

  }

  .shopping-cart:after {
    bottom: 100%;
    left: 89%;
    border: solid transparent;
    content: " ";
    height: 0;
    width: 0;
    position: absolute;
    pointer-events: none;
    border-bottom-color: white;
    border-width: 8px;
    margin-left: -8px;
  }

  .cart-icon {
    color: #515783;
    font-size: 24px;
    margin-right: 7px;
    float: left;
  }

  .button {
    background: $main-color;
    color: white;
    text-align: center;
    padding: 12px;
    text-decoration: none;
    display: block;
    border-radius: 3px;
    font-size: 16px;
    margin: 25px 0 15px 0;

    &:hover {
      background: lighten($main-color, 3%);
    }
  }

  .clearfix:after {
    content: "";
    display: table;
    clear: both;
  }





  .emp-profile {
    padding: 3%;
    margin-top: 3%;
    margin-bottom: 3%;
    border-radius: 0.5rem;
    background: #fff;
  }

  .profile-img {
    text-align: center;
  }

  .profile-img img {
    width: 70%;
    height: 100%;
  }

  .profile-img .file {
    position: relative;
    overflow: hidden;
    margin-top: -20%;
    width: 70%;
    border: none;
    border-radius: 0;
    font-size: 15px;
    background: #212529b8;
  }

  .profile-img .file input {
    position: absolute;
    opacity: 0;
    right: 0;
    top: 0;
  }

  .profile-head h5 {
    color: #333;
  }

  .profile-head h6 {
    color: #0062cc;
  }

  .profile-edit-btn {
    border: none;
    border-radius: 1.5rem;
    width: 70%;
    padding: 2%;
    font-weight: 600;
    color: #6c757d;
    cursor: pointer;
  }


  .profile-head .nav-tabs {
    margin-bottom: 5%;
  }

  .profile-head .nav-tabs .nav-link {
    font-weight: 600;
    border: none;
  }

  .profile-head .nav-tabs .nav-link.active {
    border: none;
    border-bottom: 2px solid #0062cc;
  }

  .profile-tab label {
    font-weight: 600;
  }

  .profile-tab p {
    font-weight: 600;
    color: #0062cc;
  }
</style>
<script>
  function ajaxOrderCall(Orderid, status) {
    $.ajax({
      type: "POST",
      url: "/restaurant/status/",
      data: JSON.stringify([{
        'Orderid': Orderid
      }, {
        'Status': status
      }]),
      success: function (data) {
        console.log(data)
        location.reload()
      }
    })
  }

  $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    var target = $(e.target).attr("href")
    alert(target);
  });
</script>

<body>
  <nav class="topnav">
    <div class="container">
      <a class="navbar-brand" href="/">FOOD Machine</a>
      <a class="active" href="/">Home</a>
      <a href="#contact">Contact</a>
      {% if user.is_authenticated %}
      <a class="active" href="/dashboard/">{{user.username}}</a>
      <a class="" href="/logout/"> Logout </a>
      {% else %}
      <a class="active" href="{% url 'login' %}?next={{request.path}}">Login</a>
      {% endif %}
      <ul class="navbar-right">
        <li><a href="/cart/checkout" id="cart"><i class="fa fa-shopping-cart"></i> Cart <span class="badge">
              <script>
                var data = JSON.parse(localStorage.getItem('quantity'))['Quantity'];
                document.write(data);
              </script>
            </span></a></li>
      </ul>
    </div>
  </nav>

  <div class="container emp-profile">

    <div class="row">

      <a href='/restaurant/createRestaurant/'>Create Restaurant</a>
      <div class="col-md-6">
        <div class="profile-head">
          <h5>
            {{user.first_name}} {{user.last_name}}
          </h5>
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
                aria-selected="true">Orders</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
                aria-selected="false">Profile</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-2">
        <input type="submit" class="profile-edit-btn" name="btnAddMore" value="Edit Profile" />
      </div>
    </div>
    <div class="row">
      <div class="col-md-8">
        <div class="tab-content profile-tab" id="myTabContent">
          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
            <div class="card2">
              <table class="table table-hover shopping-cart-wrap">
                <thead class="text-muted">
                  <tr>
                    <th scope="col" style="color: black">Order</th>
                    <th scope="col" width="120" style="color: black;">Items{Item_name{Quanity:price}}</th>
                    <th scope="col" width="120" style="color: black;">Price</th>
                    <th scope="col" width="200" class="text-right" style="color: black;">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for ord in Orders %}
                  {%with ord.user.username|getProfile as pa%}
                  <tr>
                    <td>
                      <figure class="media">
                        <figcaption class="media-body">
                          <h6 style="color: black; font-size: 22px;" class="title text-truncate">{{ord.Order_Id}} </h6>
                          <dl class="param param-inline small">
                            <dt>Items: </dt>
                            {{ord.Menu_Item}}
                            {{pa.Address}}
                          </dl>
                        </figcaption>
                      </figure>
                    </td>
                    <td>
                      {{ord.orderDate}}
                    </td>
                    <td>
                      <div class="price-wrap">
                        <var class="price">{{ord.Price}}</var>
                      </div>
                    </td>
                    <td class="text-right">
                      {%if ord.Status == 's'%}
                      <button type="button" id='{{ord.Ord_Id}}a'
                        onclick="ajaxOrderCall('{{ord.Order_Id}}','r')">Accept</button>
                      <button type="button" id='{{ord.Ord_Id}}d'
                        onclick="ajaxOrderCall('{{ord.Order_Id}}','e')">Decline</button>
                      {%else%}
                      <button type="button" id='{{ord.Ord_Id}}p' onclick="ajaxOrderCall('{{ord.Order_Id}}','d')"> Ready
                        Pick Up</button>
                      {%endif%}

                    </td>
                  </tr>
                  {%endwith%}
                  {%endfor%}
                </tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
            <div class="card2">
              <table class="table table-hover shopping-cart-wrap">
                <thead class="text-muted">
                  <tr>
                    <th scope="col" style="color: black">Order</th>
                    <th scope="col" width="120" style="color: black;">Items</th>
                    <th scope="col" width="120" style="color: black;">Price</th>
                    <th scope="col" width="200" class="text-right" style="color: black;">Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for ord in My %}
                  {%with ord.user.username|getProfile as pa%}
                  <tr>
                    <td>
                      <figure class="media">
                        <figcaption class="media-body">
                          <h6 style="color: black; font-size: 22px;" class="title text-truncate">{{ord.Order_Id}} </h6>
                          <dl class="param param-inline small">
                            <dt>Items: </dt>
                            {{ord.Menu_Item}}
                            {{pa.Address}}
                          </dl>
                        </figcaption>
                      </figure>
                    </td>
                    <td>
                      {{ord.orderDate}}
                    </td>
                    <td>
                      <div class="price-wrap">
                        <var class="price">{{ord.Price}}</var>
                      </div>
                    </td>
                  </tr>
                  {%endwith%}
                  {%endfor%}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

</body>